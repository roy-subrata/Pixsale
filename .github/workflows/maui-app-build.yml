name: Build MAUI App (Android Only)

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-package-android:
    name: Build and Package Android
    runs-on: windows-latest

    steps:
    - name: Get the code
      uses: actions/checkout@v4

    - name: Set up .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '9.0.x' # Replace with your MAUI framework version

    - name: Restore project dependencies
      run: dotnet restore

    - name: Build Android App
      run: dotnet build -c Release -f net9.0-android

    - name: Decode Android Keystore
      shell: bash
      run: |
        echo "${{ secrets.ANDROID_KEYSTORE_BASE64 }}" | base64 -d > android.keystore

    - name: Sign and Package Android App
      run: |
        msbuild src/Services/Pixsale.App.csproj /t:SignAndroidPackage /p:Configuration=Release /p:AndroidPackageFormat=aab /p:AndroidKeyStore=True /p:AndroidSigningKeyStore=android.keystore /p:AndroidSigningStorePass="${{ secrets.ANDROID_KEYSTORE_PASSWORD }}" /p:AndroidSigningKeyAlias="${{ secrets.ANDROID_KEY_ALIAS }}" /p:AndroidSigningKeyPass="${{ secrets.ANDROID_KEY_PASSWORD }}"

    - name: Save the built app (android)
      uses: actions/upload-artifact@v4 # Or try @v2
      with:
        name: android-app
        path: |
          ./bin/Release/*/*.apk
